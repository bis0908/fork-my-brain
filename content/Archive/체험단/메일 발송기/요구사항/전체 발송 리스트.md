---
Create at: 2024-03-18
tags:
  - Javascript
  - renamailer
  - design/implements
---
---
#### 요구사항
- ADD ID 시 전체 리스트에 추가  (중복방지)

- 전체 리스트에는 선택한 발송기 마다  할당, 비할당 상태가 존재함.
- 기존 메일ID 탭에는 할당 상태의 메일이 표시 되고,  비할당 상태로 토글하면 메일id 탭에서 사라짐.
- UI는  메일주소  |  할당 or  비할당 버튼

- 메일 수정 기능은 전체리스트에서만 가능하고
- 전체리스트에서 메일 수정을 하면 할당 된 모든 발송기에 반영되어야 함.

- 즉 모든 메일은 전체메일 탭에서 관리하고, 
- 각 발송기에서는 특정 메일을 할당/비할당 할 수 있으며 할당 된 메일들로 보내게 됨.

- A메일을 B로 변경 시 A로 발송 대기중인 모든 메일도 B로 변경되어야 함.

---

#### 구현

- 프론트
	- [x] 전체 발송 리스트가 쭉 있고 오른쪽에 토글 스위치를 하나씩 달아놓는 형태. ✅ 2024-03-19
	- [x] 발송 리스트 호출 함수 / DOM 생성 함수 분리 ✅ 2024-03-19
	- [x] `<ul>` 태그 사용 ✅ 2024-03-19
	- [ ] ~~각 토글 스위치 data 속성에 no, agent_no를 넣어둔다.~~
	- [x] 스위칭 on/off 된 메일 계정은 현재 발송기 메일ID 탭에 추가/제거한다. ✅ 2024-03-19
		- [x] db 트랜잭션 post 요청 (sensitiveInfo가 이때 필요함) ✅ 2024-03-19
	- [ ] 메일 발송 눌렀을때 할당된 메일 계정 정보가 db로 전송 되는가?
	- [x] sensitiveInfo 재설계 ✅ 2024-03-20
		- [x] 민감정보 제거 작업 (암호) ✅ 2024-03-20
		- [x] 애초에 이 정보를 가져올 필요가 있는지 재검토 ✅ 2024-03-20
	- [ ] add New Id 버튼을 클릭시
		- [ ] 전체 메일 리스트에 preappend로 추가된다. (최상단에 추가)
		- [ ] 메일 ID 탭에는 추가되지 않는다
	- [ ] 발송기 검색바 추가
	- [ ] `Socket.io` 를 활용한 메일 할당 실시간 공유 기능
- 백엔드
	- [x] mail_google_sender 테이블에서 id 선택. ✅ 2024-03-19
	- [ ] mail_google_sender 행 업데이트 쿼리
	- [ ] ~~mail_delivery_schedule 테이블에서 토글 전 후 발송 계정 바뀌면 업데이트 로직~~
	- [x] sensitiveInfo에서 민감정보 제거 작업 (암호) ✅ 2024-03-20
		- [x] 스케줄러 등록시 한번만 해당 발송 계정의 암호를 가져와야 한다. ✅ 2024-03-20
	- [ ] `Sockie.io` 설정
	
- 확인사항
	- [ ] 발송기별로 메일 중복이 있는데 어떻게 처리하지?
		- ~~id만 가져올때는 중복 제거 가능. 하지만 no, agent_no와 함께 가져오면 중복 제거 불가능.
		- ~~ui 상 중복이 없다고 가정했을 경우
			- ~~현재 선택 id와 동일한 이메일을 스위칭
		- 메일 id만 중복없이 가져온다.
		- 다른 발송기에 등록된 건 바뀌면 안되지 않을까?
			- 기존 id를 update가 아닌 삭제, 추가로 분할
	- [x] 할당 스위칭을 어떻게 하지? ✅ 2024-03-19
		- [x] 선행조건: 발송기 1차 선택 필요 ✅ 2024-03-19
	- [ ] ~~mail_delivery_schedule 업데이트 로직에 필요 사항~~
		- [ ] ~~현재 발송 중인 행이 있는가?~~
		- [ ] ~~있다면 before id, pw, after id, pw 업데이트~~
	- [ ] 현재 발송기의 메일 계정으로 발송중인데 이 계정이 바뀌면?
		- 바뀐 메일 계정으로 발송 스케줄러의 기존 메일 계정 업데이트인데,
		- 발송 할당을 아예 빼버린 경우에는? 메일 계정을 할당 안하면?
		- #### 스케줄러에 이미 등록된 메일 계정은 변경하지 않는 것으로 협의

- 예외처리
	- [x] 발송기를 선택하지 않았을 경우? ✅ 2024-03-19
		- [x] 할당 버튼을 비활성화 한다. ✅ 2024-03-19
		- [x] 발송기가 선택되면 할당 버튼을 모두 활성화 한다. ✅ 2024-03-19
	- [x] sensitiveInfo가 없을 경우 (부여된 발송 계정이 없을 경우) ✅ 2024-03-19
		- [x] senderId를 할당 ✅ 2024-03-19
	- [x] 발송기에서 선택된 메일계정이 없을경우 (1개 남은 메일 계정을 비활성화 했다면) ✅ 2024-03-19
		- [x] set agent_no = null (삭제 처리 X) ✅ 2024-03-19
		- [x] 추후 동일한 id를 insert 할때 agent_no = null인 행이 있는지 확인하고 있다면 이 행을 업데이트 처리 ✅ 2024-03-19
