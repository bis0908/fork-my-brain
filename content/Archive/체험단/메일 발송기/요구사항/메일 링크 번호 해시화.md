---
Create at: 2024-07-22
tags:
  - Javascript
  - Nodejs
  - design/idea
  - renamailer
---
---

##### 시나리오
1. 메일 본문에 추가되는 캠페인 번호를 해시해 디비에 저장을 하고 메일 발송시 캠페인 번호 대신 해시 문자열을 보내야 한다..
2. 수신자가 본문 링크를 클릭하면 db에서 해시에 맞는 캠페인 번호를 찾아 링크로 연결한다.
3. 유효기간은 30일로 설정하지만 나중에 코드상으로 변경하기 간편해야 한다.

##### 설계
1. 브라우저에서 링크삽입 버튼을 누르면, sha-256 해시를 생성하고 db rhash테이블에 저장해야 한다.
2. 링크의 url이 바뀐다.
	1. before: campaign_no=숫자
	2. after: surl=hash()
	3. 해시 로직은 (utc 밀리초+번호 조합)
	4. 숫자, 해시를 db에 저장한다.
3. 메일 발송시 중계 페이지 + 해시를 메일로 보낸다. (여기까지 발송기 할일)
4. (여기는 체험단 페이지에서 핸들링) 유저가 이 페이지로 접근하면 해시 파라미터를 가져와 db에 매칭되어 있는 캠페인 번호로 리다이렉트를 한다.