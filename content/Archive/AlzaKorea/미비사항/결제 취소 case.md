
# 결제 전
---
- 결제 전 주문 취소 -> 그냥 취소하면 됨


# 결제
---
- 일시불
- 할부
- 계좌이체

> 에스크로?
- 고객이 온라인으로 제품을 구매할 때 지불한 돈을 PG사와 같은 제3자가 보관했다가,  
고객이 제품을 잘 받은 뒤에 상점에게 돈을 지급해 주는 시스템



# 결제 후
---
- 요청 날짜 추가는 기입
- 결제 완료: 결제 직후 주문 취소 -> 전체 취소
- Read-timeout(네트워크 유실 등)으로 인해 결제 결과가 불확실할 경우 망취소 API 호출
- 제품 사용 중: 부분 취소
- end-user의 취소 요청:
	- 사유 필요
	- 공급사 주체에 문제가 있어 취소하는 경우: 공지가 필요할듯
	- 취소 요청 -> 관리자가 취소 요청을 확인할 수 있어야 함.
	- 관리자는 사유 확인 후 합당하면 취소, 아니면 거부 가능? 사전 공지 같은게 필요할 듯
	- 취소 요청 버튼에 tid 혹은 결제코드 data로 삽입해서 submit
		- 올바른 방법일까?
		- tid를 노출시키지 않는게 좋을 것 같기도?
- 환불 완료 전 까지는 철회가 가능하기 때문에 철회 case도 챙겨야 한다.
	- 철회는 유저가 할 것.
	- 카페24는 이런 기능이 있는데 나이스페이도 있는지는 확인 요


# [[결제 취소]]
---
- [x] 전체 결제 취소시 결제한 만큼의 마일리지 차감 ✅ 2023-12-13
	- [x] `payment_history`의 적립 정보를 읽어 그만큼 `user_mileage` 에서 차감 ✅ 2023-12-13
- [ ] 부분 결제 취소시 잔여 마일리지 차감
- [x] 마일리지 기능 불필요로 비활성화 처리 ✅ 2023-12-16
- [ ] 결제 취소시 취소 사유 입력란 추가
	- [ ] 취소 사유 여러개 생성 후 관리자가 선택할 수 있게끔
- [ ] 다중 결제 취소를 대비하여, 웹에서 취소결제를 여러개 선택할 수 있게끔 datatables 수정 필요.
	- [ ] 체크박스 선택시 현재 row 선택되게끔. checkbox는 data 속성으로 row no(db에서 온) 정보를 들고 있어야 함.
	- [ ] Array를 만들어서 백엔드로 던지면 반복문 돌면서 취소요청 시도.
	- [ ] 취소 도중 에러가 발생했을 경우 tid 체크하고 다음 결제 취소 시도.
	- [ ] 모두 결제 취소 성공 or 실패건 있으면 알림창에 표시
		- [ ] 취소 실패건은 웹에서 환불 완료 버튼으로 바뀌면 안됨.
- [ ] 결제 이후 유저 페이지 > 결제 내역 > 결제 취소 금액 표시 (부분 취소일 경우 금액도 표시 필요)