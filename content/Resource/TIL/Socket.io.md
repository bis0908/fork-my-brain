---
tags:
  - til/socketIo
---


|                                                |
| ---------------------------------------------- |
| 그 socket통신을 위해 짜야되는                            |
| 굉장히 많은 코드를                                     |
| 대신 해주는 좋은 라이브러리이고                              |
| 주요한 기능은 채널을 만들 수 있고                            |
| 그 채널에다가                                        |
| socket을 참여시킬 수 있고                              |
| 특정 소켓에 메시지보내기가 가능하고,                           |
| 특정 채널에 메시지 뿌리기가 가능하고,                          |
| 전체 접속자에게 메시지 뿌리기가 가능하지.                        |
| 그리고 개별 접속 된 소켓이 서버로 메시지를 던지는 것이 가능하고           |
| socket.emit ...                                |
| 이런게 메시지를 던지는거고                                 |
| 거기에 어떤 채널에 던질지...                              |
| 어떤 소켓에 보낼지                                     |
| 어떤 메시지 타입으로 보낼지                                |
| 그 메시지타입이 서버에 정의되어 었어야되고                        |
| 받는쪽이 클라이언트면 클라이언트에 정의되어 있어야하지.                 |
| 즉 특정 강의 채널에 한명이 접속을 하면                         |
| 클라이언트소켓이 서버에게 나 "ㅇㅇㅇ"채널에 참여하고 싶다고              |
| 있겠고                                            |
| 서버에서 on("join") 함수에서                           |
| 그 소켓을 해당 방에 참여 시키고                             |
| 기존 참여자들에게 lksadjflaksjdflsak라는 소켓이 새로 들어왔단다 하고 |
| new Member 라는 메시지로, Data에 참여자 소켓 ID를 던져주면      |
| 기존 참여자들(클라)는 해당 Data를 받아서                      |
| 해당 소켓을 쓰는 사용자의 닉네임은 뭐고.... 정보는 어쩌구 저쩌구고        |
| 이런것들을 저장해서                                     |
| 걔한테 채팅 메시지도 보낼 수 있을거고....                      |
| 이해됨?                                           |
| 카톡 같은거네                                        |
| 이렇게 하면 이게 결국                                   |
| 채팅방이 되는거고                                      |
| 나는 여기서 더 나아가서                                  |
| webrtc의                                        |
| 커넥션 메시지들을                                      |
| socket통신으로 왔다갔다 거리게 해서                         |
| 결국 화상 연결까지 P2P로                                |
| 연결해주는거지.                                       |
| 그리고 화이트보드 상에 그리는 모든 것들을                        |
| socket통신으로 서버를 통해서                             |
| 다른 클라이언트와 동기화 하는데 사용하고 있지.                     |
| 즉 니가 여기서 블랙박스로 여길 수 있는 부분은                     |
| 소켓 통신에 대한 강의실 내에서 일어나는 일들이고                    |
| 니가 관여해야할 부분은                                   |
| 채널 조인                                          |
| 정도지.                                           |
| 채널 리스트 받아오기랑                                   |
| 채널=강의실                                         |
| 하지만 이런 구조를 모르면                                 |
| 채널에 대한 이해도가 없었겠지                               |
| ㅇ.ㅇ...                                         |
| 그니까 방장이 방을 파면                                  |
| 서버에는                                           |
| 방장이 최초참여자가 되는                                  |
| 하나의 socket채널을 만들어야하고                           |
| 해당 socket채널에                                   |
| 뭐 json같은거로                                     |
| roomkey : 같은 데이터를 추가해서                         |
| 암호나                                            |
| 해시                                             |
| 같은거로                                           |
| 해당 채널을 서버에서 특정지을 수 있게 하고                       |
| 채널스~ 이런 변수에                                    |
| 저장해놓고                                          |
| 누가 조인하려고하면                                     |
| 그 조인하려는 키가                                     |
| 채널스에 있는지 보고                                    |
| 채널스에 있으면 해당 채널의 암호와                            |
| 조인하려는애의 암호가 같은지 확인하고                           |
| 같으면 조인시켜주고, 기존 socket 채널 참여자 (즉, 방장) 에게        |
| ㅇㅇㅇ 이 참가했습니다 메시지 던져주고.                         |
| 이런 시스템인거지.                                     |
| 여기서 이제 발생할 수 있는 이벤트들을 생각해보면,                   |
| 1. 서버가 클라이언트에게 보낸다.                            |
| 2. 클라이언트가 서버로 메시지보낸다.                          |
| 3. 연결 끊김 이벤트가 발생한다.                            |
| 4. 연결 이벤트가 발생한다                                |
| 이정도로 정리할 수 있겠고.                                |
| 1, 2 번에 대해서는 각각                                |
| 특정 소켓에 보낸다.                                    |
| 특정 채널에 보낸다                                     |
| 서버 전체에 보낸다                                     |
| 이런 종류로 나뉠 수 있겠고                                |
| 그 각각의 함수가                                      |
| broadcast                                      |
| emit                                           |
| 뭐 이런 저런 명령어들로 정의되어 있는거지.                       |